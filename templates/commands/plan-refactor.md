---
description: Plan a refactoring with impact analysis
agent: plan
---

Plan the following refactoring. Load the refactor-guide skill. Analyze the full impact before proposing changes.

Produce:

1. **Impact analysis**: all files, functions, and consumers affected
2. **Migration path**: ordered steps that keep the code working at each step
3. **Breaking changes**: what external interfaces change, if any
4. **Risk assessment**: what could go wrong and how to verify correctness
5. **Test strategy**: how to verify the refactoring did not change behavior

Refactoring:
