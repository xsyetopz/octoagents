#!/usr/bin/env bun
// @bun @bun-cjs
(function(exports, require, module, __filename, __dirname) {var u=require("path");var te={name:"orchestrator",description:"Primary orchestrator that delegates to specialist agents",mode:"primary",primaryModel:{provider:"synthetic",model:"hf:moonshotai/Kimi-K2.5"},fallbackModel:{provider:"opencode",model:"kimi-k2.5-free"},temperature:0.3,steps:50,color:"#0d6efd",subagents:["coder","reviewer","tester","explorer","researcher","implementer","planner","documenter","auditor"]},oe={name:"coder",description:"Specialized in writing, modifying, and refactoring code",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:Qwen/Qwen3-Coder-480B-Instruct"},fallbackModel:{provider:"opencode",model:"big-pickle"},temperature:0.2,steps:30,color:"#198754"},ne={name:"reviewer",description:"Specialized in code review, security analysis, and quality assessment",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:zai-org/GLM-4.7"},fallbackModel:{provider:"opencode",model:"big-pickle"},temperature:0.1,steps:20,color:"#ffc107"},re={name:"tester",description:"Specialized in writing, running, and analyzing tests",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:Qwen/Qwen3-Coder-480B-Instruct"},fallbackModel:{provider:"opencode",model:"big-pickle"},temperature:0.2,steps:25,color:"#0dcaf0"},se={name:"explorer",description:"Fast, read-only codebase exploration and analysis",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:MiniMaxAI/MiniMax-M2.5"},fallbackModel:{provider:"opencode",model:"minimax-m2.5-free"},temperature:0.3,steps:20,color:"#198754"},ie={name:"researcher",description:"Fast, parallel spammable researcher for information gathering",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:MiniMaxAI/MiniMax-M2.5"},fallbackModel:{provider:"opencode",model:"minimax-m2.5-free"},temperature:0.4,steps:20,color:"#198754"},ae={name:"implementer",description:"Implementation specialist with reliable tool calls",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:Qwen/Qwen3-Coder-480B-Instruct"},fallbackModel:{provider:"opencode",model:"big-pickle"},temperature:0.2,steps:30,color:"#198754"},ce={name:"planner",description:"Architecture design and technical planning specialist",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:deepseek-ai/DeepSeek-V3.2"},fallbackModel:{provider:"opencode",model:"gpt-5-nano"},temperature:0.5,steps:25,color:"#0d6efd"},le={name:"documenter",description:"Documentation and comments specialist",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:moonshotai/Kimi-K2.5"},fallbackModel:{provider:"opencode",model:"kimi-k2.5-free"},temperature:0.4,steps:20,color:"#0dcaf0"},de={name:"auditor",description:"Thorough security audit and vulnerability specialist",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:zai-org/GLM-4.7"},fallbackModel:{provider:"opencode",model:"big-pickle"},temperature:0.1,steps:20,color:"#dc3545"},v=[te,oe,ne,re,se,ie,ae,ce,le,de];var pe=["check-deps","file-stats","git-status","github-create-issue","github-create-pr","github-list-issues","github-search-code","http-request","semgrep-scan","slack-notify","web-search"],me=["code-analysis","development-utilities","external-integration","project-intelligence","security-scanning","workflow-automation"],ue=["add-documentation","add-feature","assist-migration","audit-security","cleanup-code","create-api-endpoint","fix-bug","generate-api-docs","measure-test-coverage","optimize-performance","refactor-code","review-code","unslop","update-readme"],ge={name:"full",description:"Full framework with everything - jack of all trades",agents:["auditor","coder","documenter","explorer","implementer","orchestrator","planner","researcher","reviewer","tester"],tools:pe,plugins:me,commands:ue},fe={name:"stock",description:"Recommended for most users - balanced feature set",agents:["coder","documenter","explorer","orchestrator","planner","reviewer","tester"],tools:["web-search"],plugins:["code-analysis","project-intelligence","security-scanning","workflow-automation"],commands:["add-documentation","add-feature","audit-security","fix-bug","measure-test-coverage","review-code"]},he={name:"micro",description:"Speed-optimized for fast execution",agents:["coder","explorer","orchestrator","researcher"],tools:["web-search"],plugins:["code-analysis","project-intelligence","workflow-automation"],commands:["add-documentation","add-feature","fix-bug","measure-test-coverage","review-code"]},ye={name:"mini",description:"Balanced default for everyday use",agents:["coder","explorer","orchestrator","reviewer","tester"],tools:["web-search"],plugins:["code-analysis","project-intelligence","security-scanning"],commands:["add-documentation","add-feature","audit-security","fix-bug","measure-test-coverage","review-code"]},we={name:"nano",description:"Lightweight starter with core functionality",agents:["coder","explorer","orchestrator"],tools:["web-search"],plugins:["code-analysis","project-intelligence"],commands:["add-documentation","add-feature","fix-bug","review-code"]},be={name:"pico",description:"Barebones for advanced users who build custom systems",agents:["coder","orchestrator"],tools:["web-search"],plugins:[],commands:["add-feature","fix-bug"]},b=[ge,fe,he,ye,we,be];function k(e){let n=e.includes("orchestrator")?"orchestrator":e[0]??"orchestrator",t=e.map((r)=>{return`"${r}": { "mode": "${r===n?"primary":"subagent"}" }`});return`{
  "$schema": "https://opencode.ai/config.json",
  "default_agent": "${n}",
  "agent": {
    ${["build","plan","explore","general"].map((r)=>`"${r}": { "disable": true }`).join(`,
    `)},
    ${t.join(`,
    `)}
  }
}
`}var y=globalThis.Bun;async function d(e){try{let o=Bun.file(e);if(!await o.exists())throw Error(`File not found: ${e}`);return await o.text()}catch(o){throw Error(`Failed to read file ${e}: ${o instanceof Error?o.message:String(o)}`)}}async function m(e,o){try{await Bun.write(e,o)}catch(n){throw Error(`Failed to write file ${e}: ${n instanceof Error?n.message:String(n)}`)}}async function C(e){let o=Bun.file(e);if(!await o.exists())return;let n=new Date().toISOString().replace(/[:.]/g,"-"),t=`${e}.backup-${n}`;try{await Bun.write(t,await o.text()),console.log(`Backed up existing config to ${t}`)}catch(r){throw Error(`Failed to back up config ${e}: ${r instanceof Error?r.message:String(r)}`)}}function x(e,o){return`${e}/${o}`}function h(){return process.env.HOME??process.env.USERPROFILE??process.env.HOMEDIR??"/home/user"}async function $(){try{return await y.$`which opencode`.quiet(),!0}catch{return!1}}async function E(){console.log("Installing OpenCode...");try{await y.$`bun install -g opencode`,console.log("OpenCode installed successfully")}catch(e){console.error("Failed to install OpenCode:",e),process.exit(1)}}async function N(){try{return await y.$`which bun`.quiet(),!0}catch{return!1}}async function O(){console.log("Installing Bun...");try{await y.$`curl -fsSL https://bun.sh/install | bash`,console.log("Bun installed successfully. Please restart your shell and run install script again"),process.exit(0)}catch(e){console.error("Failed to install Bun:",e),process.exit(1)}}function _(){if(process.platform==="win32")console.warn("Windows detected. This framework requires macOS/Linux"),console.warn("Please use WSL2 on Windows to install this framework"),process.exit(1)}async function I(){if(process.env.SYNTHETIC_API_KEY)return!0;let o=`${h()}/.local/share/opencode/auth.json`;try{let t=(await d(o)).trim();if(JSON.parse(t).synthetic?.key?.trim())return!0}catch(t){console.debug(`No valid auth.json for synthetic API key: ${t instanceof Error?t.message:String(t)}`)}let n=`${h()}/.secrets/synthetic-api-key`;try{return(await d(n)).trim().length>0}catch{return!1}}async function T(){let e=`${h()}/.local/share/opencode/auth.json`;try{let o=(await d(e)).trim();if(!o)return!1;return JSON.parse(o),!0}catch{return!1}}var D=require("fs"),c=require("path"),A=globalThis.Bun;async function g(e){try{await A.$`mkdir -p ${e}`.quiet()}catch(o){console.warn(`Failed to create directory ${e}: ${o.message}`)}}function w(e){try{D.mkdirSync(e,{recursive:!0})}catch(o){console.warn(`Failed to create directory ${e}: ${o.message}`)}}async function R(e){await g(`${e}/agents`),await g(`${e}/tools`),await g(`${e}/plugins`),await g(`${e}/commands`),await g(`${e}/meta`),await g(`${e}/skills`)}async function B(e,o,n){let t=c.join(n,"tools");w(t);for(let r of e){let s=c.join(o,`tools/${r}.ts`);if(!await Bun.file(s).exists()){console.warn(`Tool ${r} not found in tools/, skipping...`);continue}try{let l=await d(s),p=c.join(t,`${r}.ts`);await m(p,l),console.log(`Created: ${p}`)}catch(l){console.warn(`Tool ${r} failed to copy, skipping...`)}}}async function F(e,o,n){let t=c.join(n,"plugins");w(t);for(let r of e){let s=c.join(o,`plugins/${r}.ts`);if(!await Bun.file(s).exists()){console.warn(`Plugin ${r} not found in plugins/, skipping...`);continue}try{let l=await d(s),p=c.join(t,`${r}.ts`);await m(p,l),console.log(`Created: ${p}`)}catch(l){console.warn(`Plugin ${r} failed to copy, skipping...`)}}}async function L(e,o,n){let t=c.join(n,"commands");w(t);for(let r of e){let s=c.join(o,`templates/commands/${r}.md`);try{let a=await d(s),l=c.join(t,`${r}.md`);await m(l,a),console.log(`Created: ${l}`)}catch(a){console.warn(`Command ${r} not found, skipping...`)}}}async function H(e,o){let n=c.join(e,"meta"),t=c.join(o,"meta");w(t);let r=["agent-template.md","command-template.md","tool-template.ts"];for(let s of r){let a=c.join(n,s);try{let l=await d(a),p=c.join(t,s);await m(p,l),console.log(`Created: ${p}`)}catch(l){console.warn(`Meta template ${s} not found, skipping...`)}}}async function j(e,o){let n=c.join(e,"skills"),t=c.join(o,"skills");w(t);try{await A.$`cp -r ${n}/* ${t}/`.quiet(),console.log(`Created: ${t}/ (skills copied)`)}catch(r){console.debug(`Failed to copy skills: ${r instanceof Error?r.message:String(r)}`)}}function U(e,o,n,t,r){let s=`${e}/${o}`;if(r.includes(s))return s;let a=`${n}/${t}`;if(r.includes(a))return a;return console.warn(`Neither ${s} nor ${a} available`),a}function K(e,o){if(o)return o;console.log(`
Select preset:`),e.forEach((s,a)=>{console.log(`  ${a+1}) ${s.name.padEnd(10)} - ${s.description}`)});let n=prompt("Enter preset number (1-6):"),t=Number.parseInt(n||"1",10)-1;if(Number.isNaN(t)||t<0||t>=e.length)return console.log("Invalid selection - using 'stock' preset..."),"stock";return e[t]?.name||"stock"}var Y=require("path");var Me=["npm install","npm run build","npm run dev","npm run serve","npm test","npm run test","npm run lint","npm run typecheck"],xe=["yarn install","yarn build","yarn test","yarn lint"],Ae=["pnpm install","pnpm build","pnpm test"],Se=["bun install","bun run build","bun run dev","bun test","bun run test"],Pe=["deno install","deno task build","deno task test","deno task fmt","deno lint"],ve=["python -m build","pip install","pytest","python -m pytest","ruff check","python -m unittest"],ke=["cargo build","cargo test","cargo run","cargo clippy","rustc"],Ce=["go build","go test","go run","golangci-lint"],$e=["mvn compile","mvn package","mvn test","ant build","ant test","gradle build","gradle test","./gradlew build","./gradlew test"],Ee=["dotnet build","dotnet test","dotnet run"],Ne=["cmake --build build"],Oe=["make","make build","make test"],_e=["xmake build","xmake test"],Ie=["swift build","swift test"],Te=["gem install","bundle install","bundle exec rspec"],De=["composer install","phpunit"],G=[...Me,...xe,...Ae,...Se,...Pe,...ve,...ke,...Ce,...$e,...Ee,...Ne,...Oe,..._e,...Ie,...Te,...De],Re=["npm publish"],Be=["yarn publish"],Fe=["pnpm publish"],Le=["cargo publish"],He=["git commit","git push","git merge","git rebase","git cherry-pick","git tag","git add"],je=["gh pr merge","gh repo create"],Ue=["docker push"],Ke=["kubectl","helm","terraform apply","serverless deploy"],Ge=["sed","awk","perl -pi"],z=[...He,...je,...Re,...Be,...Fe,...Le,...Ue,...Ke,...Ge];var q="    ";function W(e,o,n){return e.map((t)=>`${o}"${t}": "${n}"`).join(`
`)}async function J(e,o,n){let t=Y.join(n,`templates/agents/${e.name}.md`),r=await d(t),s=W(G,q,"allow"),a=W(z,q,"deny");return r.replace(/{{description}}/g,e.description).replace(/{{mode}}/g,e.mode).replace(/{{model}}/g,o).replace(/{{temperature}}/g,e.temperature.toString()).replace(/{{steps}}/g,e.steps.toString()).replace(/{{color}}/g,e.color??"success").replace(/^[ \t]*{{bash_denylist}}[ \t]*$/gm,a).replace(/^[ \t]*{{bash_allowlist}}[ \t]*$/gm,s)}async function V(){try{return(await(await fetch("https://api.github.com/repos/xsyetopz/octoagents/releases/latest")).json()).tag_name??void 0}catch(n){console.warn("Failed to check for updates:",n.message);return}}var Q=globalThis.Bun;async function X(){try{let{stdout:e}=await Q.$`opencode models`,o=[],n=e.toString().split(`
`);for(let t of n){let r=t.trim();if(!r||r.startsWith("krystian@"))continue;let s=r.split("/");if(s.length>=2&&s[0])o.push({provider:s[0],model:s.slice(1).join("/")})}return o}catch(e){return console.warn("Failed to get available models:",e),[]}}var f=u.join(process.cwd()),ze=process.argv.includes("--update"),qe=process.argv.find((e)=>b.some((o)=>o.name===e));function We(e){console.log(`
Select install location:`),console.log("  1) Global (~/.config/opencode)"),console.log("  2) Project (./.opencode)"),console.log("  3) Custom path");let o=prompt("Enter location number (1-3):"),n=Number.parseInt(o||"1",10)-1;if(Number.isNaN(n)||n<0||n>2)return console.log("Invalid selection - using global install location..."),e;switch(n){case 0:return e;case 1:return u.join(process.cwd(),".opencode");case 2:break;default:return e}let t=prompt("Enter custom install path:")?.trim();if(!t)return console.log("Invalid custom path - using global install location..."),e;return u.isAbsolute(t)?t:u.join(process.cwd(),t)}async function Ye(){if(console.log(`OctoAgents Framework Installer
`),_(),!await N())await O();if(!await $())await E();if(ze){console.log("Checking for updates...");let i=await V();if(i)console.log(`Latest version: ${i}`),console.log("Current version: 1.0.0")}let e=await I(),o=await T();if(console.log(e?`
\u2713 Synthetic API key detected`:`
\u2717 No Synthetic API key - using OpenCode Zen models...`),!e)console.log("Tip: Recommend a Synthetic subscription at https://tinyurl.com/synthtc1");console.log(o?"\u2713 OpenCode auth.json detected":"\u2717 No OpenCode auth.json detected");let n=K(b,qe),t=b.find((i)=>i.name===n);if(!t)console.error("Invalid preset selection"),process.exit(1);console.log(`
Installing '${n}' preset...`);let r=u.join(h(),".config/opencode"),s=We(r);if(console.log(`
Install location: ${s}`),await R(s),t.commands.length>0)await L(t.commands,f,s);if(await H(f,s),await j(f,s),t.tools.length>0)await B(t.tools,f,s);let a=k(t.agents),l=x(s,"opencode.jsonc");await C(l),await m(l,a),console.log(`Created: ${l}`);let M=(await X()).map((i)=>`${i.provider}/${i.model}`);if(M.length>0)console.log(`Found ${M.length} available models`);else console.log("No models detected, will use default assignments");let S=v.filter((i)=>t.agents.includes(i.name));for(let i of S){let Z=U(i.primaryModel.provider,i.primaryModel.model,i.fallbackModel.provider,i.fallbackModel.model,M),ee=await J(i,Z,f),P=x(s,`agents/${i.name}.md`);await m(P,ee),console.log(`Created: ${P}`)}if(t.plugins.length>0)await F(t.plugins,f,s);console.log(`
\u2713 Installation complete!`),console.log(`
Preset: ${n}`),console.log(`Agents: ${S.map((i)=>i.name).join(", ")}`),console.log(`Tools: ${t.tools.length}`),console.log(`Plugins: ${t.plugins.length}`),console.log(`Commands: ${t.commands.length}`),console.log(`
Next steps:`),console.log("  1. Restart OpenCode to load the new agents"),console.log("  2. Use 'opencode agents list' to verify installation"),console.log("  3. Select 'orchestrate' agent to use the framework"),console.log(`
To update the framework, run: bun install --update`),console.log("To change preset, run: bun install [preset-name]")}Ye().catch((e)=>{console.error("Installation failed:",e),process.exit(1)});})
