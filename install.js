#!/usr/bin/env bun
// @bun @bun-cjs
(function(exports, require, module, __filename, __dirname) {var g=require("path");var re={name:"orchestrator",description:"Primary orchestrator that delegates to specialist agents",mode:"primary",primaryModel:{provider:"synthetic",model:"hf:moonshotai/Kimi-K2.5"},fallbackModel:{provider:"opencode",model:"kimi-k2.5-free"},temperature:0.3,steps:50,color:"#0d6efd",subagents:["coder","reviewer","tester","explorer","researcher","implementer","planner","documenter","auditor"]},se={name:"coder",description:"Specialized in writing, modifying, and refactoring code",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:Qwen/Qwen3-Coder-480B-Instruct"},fallbackModel:{provider:"opencode",model:"big-pickle"},temperature:0.2,steps:30,color:"#198754"},ie={name:"reviewer",description:"Specialized in code review, security analysis, and quality assessment",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:zai-org/GLM-4.7"},fallbackModel:{provider:"opencode",model:"big-pickle"},temperature:0.1,steps:20,color:"#ffc107"},ae={name:"tester",description:"Specialized in writing, running, and analyzing tests",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:Qwen/Qwen3-Coder-480B-Instruct"},fallbackModel:{provider:"opencode",model:"big-pickle"},temperature:0.2,steps:25,color:"#0dcaf0"},ce={name:"explorer",description:"Fast, read-only codebase exploration and analysis",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:MiniMaxAI/MiniMax-M2.5"},fallbackModel:{provider:"opencode",model:"minimax-m2.5-free"},temperature:0.3,steps:20,color:"#198754"},le={name:"researcher",description:"Fast, parallel spammable researcher for information gathering",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:MiniMaxAI/MiniMax-M2.5"},fallbackModel:{provider:"opencode",model:"minimax-m2.5-free"},temperature:0.4,steps:20,color:"#198754"},de={name:"implementer",description:"Implementation specialist with reliable tool calls",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:Qwen/Qwen3-Coder-480B-Instruct"},fallbackModel:{provider:"opencode",model:"big-pickle"},temperature:0.2,steps:30,color:"#198754"},pe={name:"planner",description:"Architecture design and technical planning specialist",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:deepseek-ai/DeepSeek-V3.2"},fallbackModel:{provider:"opencode",model:"gpt-5-nano"},temperature:0.5,steps:25,color:"#0d6efd"},me={name:"documenter",description:"Documentation and comments specialist",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:moonshotai/Kimi-K2.5"},fallbackModel:{provider:"opencode",model:"kimi-k2.5-free"},temperature:0.4,steps:20,color:"#0dcaf0"},ue={name:"auditor",description:"Thorough security audit and vulnerability specialist",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:zai-org/GLM-4.7"},fallbackModel:{provider:"opencode",model:"big-pickle"},temperature:0.1,steps:20,color:"#dc3545"},S=[re,se,ie,ae,ce,le,de,pe,me,ue];var ge=["check-deps","file-stats","git-status","github-create-issue","github-create-pr","github-list-issues","github-search-code","http-request","semgrep-scan","slack-notify","web-search"],fe=["code-analysis","development-utilities","external-integration","project-intelligence","security-scanning","workflow-automation"],he=["add-documentation","add-feature","assist-migration","audit-security","cleanup-code","create-api-endpoint","fix-bug","generate-api-docs","measure-test-coverage","optimize-performance","refactor-code","review-code","unslop","update-readme"],ye={name:"full",description:"Full framework with everything - jack of all trades",agents:["auditor","coder","documenter","explorer","implementer","orchestrator","planner","researcher","reviewer","tester"],tools:ge,plugins:fe,commands:he},we={name:"stock",description:"Recommended for most users - balanced feature set",agents:["coder","documenter","explorer","orchestrator","planner","reviewer","tester"],tools:["web-search"],plugins:["code-analysis","project-intelligence","security-scanning","workflow-automation"],commands:["add-documentation","add-feature","audit-security","fix-bug","measure-test-coverage","review-code"]},be={name:"micro",description:"Speed-optimized for fast execution",agents:["coder","explorer","orchestrator","researcher"],tools:["web-search"],plugins:["code-analysis","project-intelligence","workflow-automation"],commands:["add-documentation","add-feature","fix-bug","measure-test-coverage","review-code"]},Me={name:"mini",description:"Balanced default for everyday use",agents:["coder","explorer","orchestrator","reviewer","tester"],tools:["web-search"],plugins:["code-analysis","project-intelligence","security-scanning"],commands:["add-documentation","add-feature","audit-security","fix-bug","measure-test-coverage","review-code"]},xe={name:"nano",description:"Lightweight starter with core functionality",agents:["coder","explorer","orchestrator"],tools:["web-search"],plugins:["code-analysis","project-intelligence"],commands:["add-documentation","add-feature","fix-bug","review-code"]},Ae={name:"pico",description:"Barebones for advanced users who build custom systems",agents:["coder","orchestrator"],tools:["web-search"],plugins:[],commands:["add-feature","fix-bug"]},b=[ye,we,be,Me,xe,Ae];function k(e){let n=e.includes("orchestrator")?"orchestrator":e[0]??"orchestrator",t=e.map((r)=>{return`"${r}": { "mode": "${r===n?"primary":"subagent"}" }`});return`{
  "$schema": "https://opencode.ai/config.json",
  "default_agent": "${n}",
  "agent": {
    ${["build","plan","explore","general"].map((r)=>`"${r}": { "disable": true }`).join(`,
    `)},
    ${t.join(`,
    `)}
  }
}
`}var $=require("child_process"),E=require("util");async function p(e){try{let o=Bun.file(e);if(!await o.exists())throw Error(`File not found: ${e}`);return await o.text()}catch(o){throw Error(`Failed to read file ${e}: ${o instanceof Error?o.message:String(o)}`)}}async function u(e,o){try{await Bun.write(e,o)}catch(n){throw Error(`Failed to write file ${e}: ${n instanceof Error?n.message:String(n)}`)}}async function C(e){let o=Bun.file(e);if(!await o.exists())return;let n=new Date().toISOString().replace(/[:.]/g,"-"),t=`${e}.backup-${n}`;try{await Bun.write(t,await o.text()),console.log(`Backed up existing config to ${t}`)}catch(r){throw Error(`Failed to back up config ${e}: ${r instanceof Error?r.message:String(r)}`)}}function A(e,o){return`${e}/${o}`}var M=E.promisify($.exec);function y(){return process.env.HOME??process.env.USERPROFILE??process.env.HOMEDIR??"/home/user"}async function O(){try{return await M("which opencode"),!0}catch(e){return!1}}async function N(){console.log("Installing OpenCode...");try{await M("bun install -g opencode"),console.log("OpenCode installed successfully")}catch(e){console.error("Failed to install OpenCode:",e),process.exit(1)}}async function _(){try{return await M("which bun"),!0}catch(e){return!1}}async function I(){console.log("Installing Bun...");try{await M("curl -fsSL https://bun.sh/install | bash"),console.log("Bun installed successfully. Please restart your shell and run install script again"),process.exit(0)}catch(e){console.error("Failed to install Bun:",e),process.exit(1)}}function T(){if(process.platform==="win32")console.warn("Windows detected. This framework requires macOS/Linux"),console.warn("Please use WSL2 on Windows to install this framework"),process.exit(1)}async function D(){if(process.env.SYNTHETIC_API_KEY)return!0;let o=`${y()}/.local/share/opencode/auth.json`;try{let t=(await p(o)).trim();if(JSON.parse(t).synthetic?.key?.trim())return!0}catch(t){console.debug(`No valid auth.json for synthetic API key: ${t instanceof Error?t.message:String(t)}`)}let n=`${y()}/.secrets/synthetic-api-key`;try{return(await p(n)).trim().length>0}catch{return!1}}async function R(){let e=`${y()}/.local/share/opencode/auth.json`;try{let o=(await p(e)).trim();if(!o)return!1;return JSON.parse(o),!0}catch{return!1}}var B=require("fs"),x=require("fs/promises"),c=require("path");async function f(e){try{await x.mkdir(e,{recursive:!0})}catch(o){console.warn(`Failed to create directory ${e}: ${o.message}`)}}function w(e){try{B.mkdirSync(e,{recursive:!0})}catch(o){console.warn(`Failed to create directory ${e}: ${o.message}`)}}async function L(e){await f(`${e}/agents`),await f(`${e}/tools`),await f(`${e}/plugins`),await f(`${e}/commands`),await f(`${e}/meta`),await f(`${e}/skills`)}async function F(e,o,n){let t=c.join(n,"tools");w(t);for(let r of e){let s=c.join(o,`tools/${r}.ts`),{access:i}=await import("fs/promises"),{constants:l}=await import("fs");try{await i(s,l.F_OK)}catch(d){console.warn(`Tool ${r} not found in tools/, skipping...`);continue}try{let d=await p(s),m=c.join(t,`${r}.ts`);await u(m,d),console.log(`Created: ${m}`)}catch(d){console.warn(`Tool ${r} failed to copy, skipping...`)}}}async function H(e,o,n){let t=c.join(n,"plugins");w(t);for(let r of e){let s=c.join(o,`plugins/${r}.ts`),{access:i}=await import("fs/promises"),{constants:l}=await import("fs");try{await i(s,l.F_OK)}catch(d){console.warn(`Plugin ${r} not found in plugins/, skipping...`);continue}try{let d=await p(s),m=c.join(t,`${r}.ts`);await u(m,d),console.log(`Created: ${m}`)}catch(d){console.warn(`Plugin ${r} failed to copy, skipping...`)}}}async function j(e,o,n){let t=c.join(n,"commands");w(t);for(let r of e){let s=c.join(o,`templates/commands/${r}.md`);try{let i=await p(s),l=c.join(t,`${r}.md`);await u(l,i),console.log(`Created: ${l}`)}catch(i){console.warn(`Command ${r} not found, skipping...`)}}}async function U(e,o){let n=c.join(e,"meta"),t=c.join(o,"meta");w(t);let r=["agent-template.md","command-template.md","tool-template.ts"];for(let s of r){let i=c.join(n,s);try{let l=await p(i),d=c.join(t,s);await u(d,l),console.log(`Created: ${d}`)}catch(l){console.warn(`Meta template ${s} not found, skipping...`)}}}async function K(e,o){let n=c.join(e,"skills"),t=c.join(o,"skills");w(t);try{await x.cp(n,t,{recursive:!0,force:!0}),console.log(`Created: ${t}/ (skills copied)`)}catch(r){console.debug(`Failed to copy skills: ${r instanceof Error?r.message:String(r)}`)}}function G(e,o,n,t,r){let s=`${e}/${o}`;if(r.includes(s))return s;let i=`${n}/${t}`;if(r.includes(i))return i;return console.warn(`Neither ${s} nor ${i} available`),i}function z(e,o){if(o)return o;console.log(`
Select preset:`),e.forEach((s,i)=>{console.log(`  ${i+1}) ${s.name.padEnd(10)} - ${s.description}`)});let n=prompt("Enter preset number (1-6):"),t=Number.parseInt(n||"1",10)-1;if(Number.isNaN(t)||t<0||t>=e.length)return console.log("Invalid selection - using 'stock' preset..."),"stock";return e[t]?.name||"stock"}var Q=require("path");var ve=["npm install","npm run build","npm run dev","npm run serve","npm test","npm run test","npm run lint","npm run typecheck"],Pe=["yarn install","yarn build","yarn test","yarn lint"],Se=["pnpm install","pnpm build","pnpm test"],ke=["bun install","bun run build","bun run dev","bun test","bun run test"],Ce=["deno install","deno task build","deno task test","deno task fmt","deno lint"],$e=["python -m build","pip install","pytest","python -m pytest","ruff check","python -m unittest"],Ee=["cargo build","cargo test","cargo run","cargo clippy","rustc"],Oe=["go build","go test","go run","golangci-lint"],Ne=["mvn compile","mvn package","mvn test","ant build","ant test","gradle build","gradle test","./gradlew build","./gradlew test"],_e=["dotnet build","dotnet test","dotnet run"],Ie=["cmake --build build"],Te=["make","make build","make test"],De=["xmake build","xmake test"],Re=["swift build","swift test"],Be=["gem install","bundle install","bundle exec rspec"],Le=["composer install","phpunit"],W=[...ve,...Pe,...Se,...ke,...Ce,...$e,...Ee,...Oe,...Ne,..._e,...Ie,...Te,...De,...Re,...Be,...Le],Fe=["npm publish"],He=["yarn publish"],je=["pnpm publish"],Ue=["cargo publish"],Ke=["git commit","git push","git merge","git rebase","git cherry-pick","git tag","git add"],Ge=["gh pr merge","gh repo create"],ze=["docker push"],We=["kubectl","helm","terraform apply","serverless deploy"],Ye=["sed","awk","perl -pi"],Y=[...Ke,...Ge,...Fe,...He,...je,...Ue,...ze,...We,...Ye];var J="    ";function V(e,o,n){return e.map((t)=>`${o}"${t}": "${n}"`).join(`
`)}async function q(e,o,n){let t=Q.join(n,`templates/agents/${e.name}.md`),r=await p(t),s=V(W,J,"allow"),i=V(Y,J,"deny");return r.replace(/{{description}}/g,e.description).replace(/{{mode}}/g,e.mode).replace(/{{model}}/g,o).replace(/{{temperature}}/g,e.temperature.toString()).replace(/{{steps}}/g,e.steps.toString()).replace(/{{color}}/g,e.color??"success").replace(/^[ \t]*{{bash_denylist}}[ \t]*$/gm,i).replace(/^[ \t]*{{bash_allowlist}}[ \t]*$/gm,s)}async function X(){try{return(await(await fetch("https://api.github.com/repos/xsyetopz/octoagents/releases/latest")).json()).tag_name??void 0}catch(n){console.warn("Failed to check for updates:",n.message);return}}var Z=require("child_process"),ee=require("util"),Je=ee.promisify(Z.exec);async function te(){try{let{stdout:e}=await Je("opencode models"),o=[],n=e.split(`
`);for(let t of n){let r=t.trim();if(!r||r.startsWith("krystian@"))continue;let s=r.split("/");if(s.length>=2&&s[0])o.push({provider:s[0],model:s.slice(1).join("/")})}return o}catch(e){return console.warn("Failed to get available models:",e),[]}}var h=g.join(process.cwd()),Ve=process.argv.includes("--update"),Qe=process.argv.find((e)=>b.some((o)=>o.name===e));function qe(e){console.log(`
Select install location:`),console.log("  1) Global (~/.config/opencode)"),console.log("  2) Project (./.opencode)"),console.log("  3) Custom path");let o=prompt("Enter location number (1-3):"),n=Number.parseInt(o||"1",10)-1;if(Number.isNaN(n)||n<0||n>2)return console.log("Invalid selection - using global install location..."),e;switch(n){case 0:return e;case 1:return g.join(process.cwd(),".opencode");case 2:break;default:return e}let t=prompt("Enter custom install path:")?.trim();if(!t)return console.log("Invalid custom path - using global install location..."),e;return g.isAbsolute(t)?t:g.join(process.cwd(),t)}async function Xe(){if(console.log(`OctoAgents Framework Installer
`),T(),!await _())await I();if(!await O())await N();if(Ve){console.log("Checking for updates...");let a=await X();if(a)console.log(`Latest version: ${a}`),console.log("Current version: 1.0.0")}let e=await D(),o=await R();if(console.log(e?`
\u2713 Synthetic API key detected`:`
\u2717 No Synthetic API key - using OpenCode Zen models...`),!e)console.log("Tip: Recommend a Synthetic subscription at https://tinyurl.com/synthtc1");console.log(o?"\u2713 OpenCode auth.json detected":"\u2717 No OpenCode auth.json detected");let n=z(b,Qe),t=b.find((a)=>a.name===n);if(!t)console.error("Invalid preset selection"),process.exit(1);console.log(`
Installing '${n}' preset...`);let r=g.join(y(),".config/opencode"),s=qe(r);if(console.log(`
Install location: ${s}`),await L(s),t.commands.length>0)await j(t.commands,h,s);if(await U(h,s),await K(h,s),t.tools.length>0)await F(t.tools,h,s);let i=k(t.agents),l=A(s,"opencode.jsonc");await C(l),await u(l,i),console.log(`Created: ${l}`);let m=(await te()).map((a)=>`${a.provider}/${a.model}`);if(m.length>0)console.log(`Found ${m.length} available models`);else console.log("No models detected, will use default assignments");let v=S.filter((a)=>t.agents.includes(a.name));for(let a of v){let oe=G(a.primaryModel.provider,a.primaryModel.model,a.fallbackModel.provider,a.fallbackModel.model,m),ne=await q(a,oe,h),P=A(s,`agents/${a.name}.md`);await u(P,ne),console.log(`Created: ${P}`)}if(t.plugins.length>0)await H(t.plugins,h,s);console.log(`
\u2713 Installation complete!`),console.log(`
Preset: ${n}`),console.log(`Agents: ${v.map((a)=>a.name).join(", ")}`),console.log(`Tools: ${t.tools.length}`),console.log(`Plugins: ${t.plugins.length}`),console.log(`Commands: ${t.commands.length}`),console.log(`
Next steps:`),console.log("  1. Restart OpenCode to load the new agents"),console.log("  2. Use 'opencode agents list' to verify installation"),console.log("  3. Select 'orchestrate' agent to use the framework"),console.log(`
To update the framework, run: bun install --update`),console.log("To change preset, run: bun install [preset-name]")}Xe().catch((e)=>{console.error("Installation failed:",e),process.exit(1)});})
