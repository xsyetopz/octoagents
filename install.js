#!/usr/bin/env bun
// @bun @bun-cjs
(function(exports, require, module, __filename, __dirname) {var m=require("path");var ee={name:"orchestrator",description:"Primary orchestrator that delegates to specialist agents",mode:"primary",primaryModel:{provider:"synthetic",model:"hf:moonshotai/Kimi-K2.5"},fallbackModel:{provider:"opencode",model:"kimi-k2.5-free"},temperature:0.3,steps:50,color:"#0d6efd",subagents:["coder","reviewer","tester","explorer","researcher","implementer","planner","documenter","auditor"]},te={name:"coder",description:"Specialized in writing, modifying, and refactoring code",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:Qwen/Qwen3-Coder-480B-Instruct"},fallbackModel:{provider:"opencode",model:"big-pickle"},temperature:0.2,steps:30,color:"#198754"},oe={name:"reviewer",description:"Specialized in code review, security analysis, and quality assessment",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:zai-org/GLM-4.7"},fallbackModel:{provider:"opencode",model:"big-pickle"},temperature:0.1,steps:20,color:"#ffc107"},ne={name:"tester",description:"Specialized in writing, running, and analyzing tests",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:Qwen/Qwen3-Coder-480B-Instruct"},fallbackModel:{provider:"opencode",model:"big-pickle"},temperature:0.2,steps:25,color:"#0dcaf0"},re={name:"explorer",description:"Fast, read-only codebase exploration and analysis",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:MiniMaxAI/MiniMax-M2.5"},fallbackModel:{provider:"opencode",model:"minimax-m2.5-free"},temperature:0.3,steps:20,color:"#198754"},se={name:"researcher",description:"Fast, parallel spammable researcher for information gathering",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:MiniMaxAI/MiniMax-M2.5"},fallbackModel:{provider:"opencode",model:"minimax-m2.5-free"},temperature:0.4,steps:20,color:"#198754"},ie={name:"implementer",description:"Implementation specialist with reliable tool calls",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:Qwen/Qwen3-Coder-480B-Instruct"},fallbackModel:{provider:"opencode",model:"big-pickle"},temperature:0.2,steps:30,color:"#198754"},ae={name:"planner",description:"Architecture design and technical planning specialist",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:deepseek-ai/DeepSeek-V3.2"},fallbackModel:{provider:"opencode",model:"gpt-5-nano"},temperature:0.5,steps:25,color:"#0d6efd"},ce={name:"documenter",description:"Documentation and comments specialist",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:moonshotai/Kimi-K2.5"},fallbackModel:{provider:"opencode",model:"kimi-k2.5-free"},temperature:0.4,steps:20,color:"#0dcaf0"},le={name:"auditor",description:"Thorough security audit and vulnerability specialist",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:zai-org/GLM-4.7"},fallbackModel:{provider:"opencode",model:"big-pickle"},temperature:0.1,steps:20,color:"#dc3545"},P=[ee,te,oe,ne,re,se,ie,ae,ce,le];var de=["check-deps","code-analysis","file-stats","git-status","github-create-issue","github-create-pr","github-list-issues","github-search-code","http-request","semgrep-scan","slack-notify","web-search"],pe=["add-documentation","add-feature","assist-migration","audit-security","cleanup-code","create-api-endpoint","fix-bug","generate-api-docs","measure-test-coverage","optimize-performance","refactor-code","review-code","unslop","update-readme"],me={name:"full",description:"Full framework with everything - jack of all trades",agents:["auditor","coder","documenter","explorer","implementer","orchestrator","planner","researcher","reviewer","tester"],tools:de,commands:pe},ue={name:"stock",description:"Recommended for most users - balanced feature set",agents:["coder","documenter","explorer","orchestrator","planner","reviewer","tester"],tools:["code-analysis","project-intelligence","security-scanning","web-search","workflow-automation"],commands:["add-documentation","add-feature","audit-security","fix-bug","measure-test-coverage","review-code"]},ge={name:"micro",description:"Speed-optimized for fast execution",agents:["coder","explorer","orchestrator","researcher"],tools:["code-analysis","project-intelligence","web-search","workflow-automation"],commands:["add-documentation","add-feature","fix-bug","measure-test-coverage","review-code"]},fe={name:"mini",description:"Balanced default for everyday use",agents:["coder","explorer","orchestrator","reviewer","tester"],tools:["code-analysis","project-intelligence","security-scanning","web-search"],commands:["add-documentation","add-feature","audit-security","fix-bug","measure-test-coverage","review-code"]},he={name:"nano",description:"Lightweight starter with core functionality",agents:["coder","explorer","orchestrator"],tools:["code-analysis","project-intelligence","web-search"],commands:["add-documentation","add-feature","fix-bug","review-code"]},ye={name:"pico",description:"Barebones for advanced users who build custom systems",agents:["coder","orchestrator"],tools:["web-search"],commands:["add-feature","fix-bug"]},M=[me,ue,ge,fe,he,ye];function k(e){let n=e.includes("orchestrator")?"orchestrator":e[0]??"orchestrator",t=e.map((r)=>{return`"${r}": { "mode": "${r===n?"primary":"subagent"}" }`});return`{
  "$schema": "https://opencode.ai/config.json",
  "default_agent": "${n}",
  "agent": {
    ${["build","plan","explore","general"].map((r)=>`"${r}": { "disable": true }`).join(`,
    `)},
    ${t.join(`,
    `)}
  }
}
`}var h=globalThis.Bun;async function d(e){try{let o=Bun.file(e);if(!await o.exists())throw Error(`File not found: ${e}`);return await o.text()}catch(o){throw Error(`Failed to read file ${e}: ${o instanceof Error?o.message:String(o)}`)}}async function p(e,o){try{await Bun.write(e,o)}catch(n){throw Error(`Failed to write file ${e}: ${n instanceof Error?n.message:String(n)}`)}}async function C(e){let o=Bun.file(e);if(!await o.exists())return;let n=new Date().toISOString().replace(/[:.]/g,"-"),t=`${e}.backup-${n}`;try{await Bun.write(t,await o.text()),console.log(`Backed up existing config to ${t}`)}catch(r){throw Error(`Failed to back up config ${e}: ${r instanceof Error?r.message:String(r)}`)}}function A(e,o){return`${e}/${o}`}function f(){return process.env.HOME??process.env.USERPROFILE??process.env.HOMEDIR??"/home/user"}async function $(){try{return await h.$`which opencode`.quiet(),!0}catch{return!1}}async function E(){console.log("Installing OpenCode...");try{await h.$`bun install -g opencode`,console.log("OpenCode installed successfully")}catch(e){console.error("Failed to install OpenCode:",e),process.exit(1)}}async function N(){try{return await h.$`which bun`.quiet(),!0}catch{return!1}}async function O(){console.log("Installing Bun...");try{await h.$`curl -fsSL https://bun.sh/install | bash`,console.log("Bun installed successfully. Please restart your shell and run install script again"),process.exit(0)}catch(e){console.error("Failed to install Bun:",e),process.exit(1)}}function _(){if(process.platform==="win32")console.warn("Windows detected. This framework requires macOS/Linux"),console.warn("Please use WSL2 on Windows to install this framework"),process.exit(1)}async function I(){if(process.env.SYNTHETIC_API_KEY)return!0;let o=`${f()}/.local/share/opencode/auth.json`;try{let t=(await d(o)).trim();if(JSON.parse(t).synthetic?.key?.trim())return!0}catch(t){console.debug(`No valid auth.json for synthetic API key: ${t instanceof Error?t.message:String(t)}`)}let n=`${f()}/.secrets/synthetic-api-key`;try{return(await d(n)).trim().length>0}catch{return!1}}async function T(){let e=`${f()}/.local/share/opencode/auth.json`;try{let o=(await d(e)).trim();if(!o)return!1;return JSON.parse(o),!0}catch{return!1}}var D=require("fs"),c=require("path"),S=globalThis.Bun;async function y(e){try{await S.$`mkdir -p ${e}`.quiet()}catch(o){console.warn(`Failed to create directory ${e}: ${o.message}`)}}function x(e){try{D.mkdirSync(e,{recursive:!0})}catch(o){console.warn(`Failed to create directory ${e}: ${o.message}`)}}async function R(e){await y(`${e}/agents`),await y(`${e}/plugins`),await y(`${e}/commands`),await y(`${e}/meta`),await y(`${e}/skills`)}async function B(e,o,n){let t=c.join(n,"plugins");x(t);for(let r of e){let s=c.join(o,`tools/${r}.ts`),a=c.join(o,`plugins/${r}.ts`),l=s;if(!await Bun.file(s).exists())l=a;try{let u=await d(l),g=c.join(t,`${r}.ts`);await p(g,u),console.log(`Created: ${g}`)}catch(u){console.warn(`Tool ${r} not found in tools/ or plugins/, skipping...`)}}}async function F(e,o,n){let t=c.join(n,"commands");x(t);for(let r of e){let s=c.join(o,`templates/commands/${r}.md`);try{let a=await d(s),l=c.join(t,`${r}.md`);await p(l,a),console.log(`Created: ${l}`)}catch(a){console.warn(`Command ${r} not found, skipping...`)}}}async function L(e,o){let n=c.join(e,"meta"),t=c.join(o,"meta");x(t);let r=["agent-template.md","command-template.md","tool-template.ts"];for(let s of r){let a=c.join(n,s);try{let l=await d(a),b=c.join(t,s);await p(b,l),console.log(`Created: ${b}`)}catch(l){console.warn(`Meta template ${s} not found, skipping...`)}}}async function H(e,o){let n=c.join(e,"skills"),t=c.join(o,"skills");x(t);try{await S.$`cp -r ${n}/* ${t}/`.quiet(),console.log(`Created: ${t}/ (skills copied)`)}catch(r){console.debug(`Failed to copy skills: ${r instanceof Error?r.message:String(r)}`)}}function j(e,o,n,t,r){let s=`${e}/${o}`;if(r.includes(s))return s;let a=`${n}/${t}`;if(r.includes(a))return a;return console.warn(`Neither ${s} nor ${a} available`),a}function U(e,o){if(o)return o;console.log(`
Select preset:`),e.forEach((s,a)=>{console.log(`  ${a+1}) ${s.name.padEnd(10)} - ${s.description}`)});let n=prompt("Enter preset number (1-6):"),t=Number.parseInt(n||"1",10)-1;if(Number.isNaN(t)||t<0||t>=e.length)return console.log("Invalid selection - using 'stock' preset..."),"stock";return e[t]?.name||"stock"}var W=require("path");var we=["npm install","npm run build","npm run dev","npm run serve","npm test","npm run test","npm run lint","npm run typecheck"],be=["yarn install","yarn build","yarn test","yarn lint"],Me=["pnpm install","pnpm build","pnpm test"],xe=["bun install","bun run build","bun run dev","bun test","bun run test"],Ae=["deno install","deno task build","deno task test","deno task fmt","deno lint"],Se=["python -m build","pip install","pytest","python -m pytest","ruff check","python -m unittest"],ve=["cargo build","cargo test","cargo run","cargo clippy","rustc"],Pe=["go build","go test","go run","golangci-lint"],ke=["mvn compile","mvn package","mvn test","ant build","ant test","gradle build","gradle test","./gradlew build","./gradlew test"],Ce=["dotnet build","dotnet test","dotnet run"],$e=["cmake --build build"],Ee=["make","make build","make test"],Ne=["xmake build","xmake test"],Oe=["swift build","swift test"],_e=["gem install","bundle install","bundle exec rspec"],Ie=["composer install","phpunit"],K=[...we,...be,...Me,...xe,...Ae,...Se,...ve,...Pe,...ke,...Ce,...$e,...Ee,...Ne,...Oe,..._e,...Ie],Te=["npm publish"],De=["yarn publish"],Re=["pnpm publish"],Be=["cargo publish"],Fe=["git commit","git push","git merge","git rebase","git cherry-pick","git tag","git add"],Le=["gh pr merge","gh repo create"],He=["docker push"],je=["kubectl","helm","terraform apply","serverless deploy"],Ue=["sed","awk","perl -pi"],G=[...Fe,...Le,...Te,...De,...Re,...Be,...He,...je,...Ue];var z="    ";function q(e,o,n){return e.map((t)=>`${o}"${t}": "${n}"`).join(`
`)}async function Y(e,o,n){let t=W.join(n,`templates/agents/${e.name}.md`),r=await d(t),s=q(K,z,"allow"),a=q(G,z,"deny");return r.replace(/{{description}}/g,e.description).replace(/{{mode}}/g,e.mode).replace(/{{model}}/g,o).replace(/{{temperature}}/g,e.temperature.toString()).replace(/{{steps}}/g,e.steps.toString()).replace(/{{color}}/g,e.color??"success").replace(/^[ \t]*{{bash_denylist}}[ \t]*$/gm,a).replace(/^[ \t]*{{bash_allowlist}}[ \t]*$/gm,s)}async function J(){try{return(await(await fetch("https://api.github.com/repos/xsyetopz/octoagents/releases/latest")).json()).tag_name??void 0}catch(n){console.warn("Failed to check for updates:",n.message);return}}var Q=globalThis.Bun;async function V(){try{let{stdout:e}=await Q.$`opencode models`,o=[],n=e.toString().split(`
`);for(let t of n){let r=t.trim();if(!r||r.startsWith("krystian@"))continue;let s=r.split("/");if(s.length>=2&&s[0])o.push({provider:s[0],model:s.slice(1).join("/")})}return o}catch(e){return console.warn("Failed to get available models:",e),[]}}var w=m.join(process.cwd()),Ke=process.argv.includes("--update"),Ge=process.argv.find((e)=>M.some((o)=>o.name===e));function ze(e){console.log(`
Select install location:`),console.log("  1) Global (~/.config/opencode)"),console.log("  2) Project (./.opencode)"),console.log("  3) Custom path");let o=prompt("Enter location number (1-3):"),n=Number.parseInt(o||"1",10)-1;if(Number.isNaN(n)||n<0||n>2)return console.log("Invalid selection - using global install location..."),e;switch(n){case 0:return e;case 1:return m.join(process.cwd(),".opencode");case 2:break;default:return e}let t=prompt("Enter custom install path:")?.trim();if(!t)return console.log("Invalid custom path - using global install location..."),e;return m.isAbsolute(t)?t:m.join(process.cwd(),t)}async function qe(){if(console.log(`OctoAgents Framework Installer
`),_(),!await N())await O();if(!await $())await E();if(Ke){console.log("Checking for updates...");let i=await J();if(i)console.log(`Latest version: ${i}`),console.log("Current version: 1.0.0")}let e=await I(),o=await T();if(console.log(e?`
\u2713 Synthetic API key detected`:`
\u2717 No Synthetic API key - using OpenCode Zen models...`),!e)console.log("Tip: Recommend a Synthetic subscription at https://tinyurl.com/synthtc1");console.log(o?"\u2713 OpenCode auth.json detected":"\u2717 No OpenCode auth.json detected");let n=U(M,Ge),t=M.find((i)=>i.name===n);if(!t)console.error("Invalid preset selection"),process.exit(1);console.log(`
Installing '${n}' preset...`);let r=m.join(f(),".config/opencode"),s=ze(r);if(console.log(`
Install location: ${s}`),await R(s),t.commands.length>0)await F(t.commands,w,s);await L(w,s),await H(w,s);let a=k(t.agents),l=A(s,"opencode.jsonc");await C(l),await p(l,a),console.log(`Created: ${l}`);let u=(await V()).map((i)=>`${i.provider}/${i.model}`);if(u.length>0)console.log(`Found ${u.length} available models`);else console.log("No models detected, will use default assignments");let g=P.filter((i)=>t.agents.includes(i.name));for(let i of g){let X=j(i.primaryModel.provider,i.primaryModel.model,i.fallbackModel.provider,i.fallbackModel.model,u),Z=await Y(i,X,w),v=A(s,`agents/${i.name}.md`);await p(v,Z),console.log(`Created: ${v}`)}if(t.tools.length>0)await B(t.tools,w,s);console.log(`
\u2713 Installation complete!`),console.log(`
Preset: ${n}`),console.log(`Agents: ${g.map((i)=>i.name).join(", ")}`),console.log(`Tools: ${t.tools.length}`),console.log(`Commands: ${t.commands.length}`),console.log(`
Next steps:`),console.log("  1. Restart OpenCode to load the new agents"),console.log("  2. Use 'opencode agents list' to verify installation"),console.log("  3. Select 'orchestrate' agent to use the framework"),console.log(`
To update the framework, run: bun install --update`),console.log("To change preset, run: bun install [preset-name]")}qe().catch((e)=>{console.error("Installation failed:",e),process.exit(1)});})
