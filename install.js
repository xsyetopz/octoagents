#!/usr/bin/env bun
// @bun @bun-cjs
(function(exports, require, module, __filename, __dirname) {var v=require("fs"),p=require("path");var te={name:"orchestrate",description:"Primary orchestrator that delegates to specialist agents",mode:"primary",primaryModel:{provider:"synthetic",model:"hf:moonshotai/Kimi-K2.5"},fallbackModel:{provider:"opencode",model:"kimi-k2.5-free"},temperature:0.3,steps:10,color:"primary",subagents:["coder","reviewer","tester","explorer","researcher","implementer","planner","documenter","auditor"]},oe={name:"coder",description:"Specialized in writing, modifying, and refactoring code",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:Qwen/Qwen3-Coder-480B-Instruct"},fallbackModel:{provider:"opencode",model:"big-pickle"},temperature:0.2,steps:8,color:"success"},ne={name:"reviewer",description:"Specialized in code review, security analysis, and quality assessment",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:zai-org/GLM-4.7"},fallbackModel:{provider:"opencode",model:"big-pickle"},temperature:0.1,steps:6,color:"warning"},re={name:"tester",description:"Specialized in writing, running, and analyzing tests",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:Qwen/Qwen3-Coder-480B-Instruct"},fallbackModel:{provider:"opencode",model:"big-pickle"},temperature:0.2,steps:6,color:"info"},se={name:"explorer",description:"Fast, read-only codebase exploration and analysis",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:MiniMaxAI/MiniMax-M2.5"},fallbackModel:{provider:"opencode",model:"minimax-m2.5-free"},temperature:0.3,steps:5,color:"success"},ie={name:"researcher",description:"Fast, parallel spammable researcher for information gathering",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:MiniMaxAI/MiniMax-M2.5"},fallbackModel:{provider:"opencode",model:"minimax-m2.5-free"},temperature:0.4,steps:4,color:"success"},ae={name:"implementer",description:"Implementation specialist with reliable tool calls",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:Qwen/Qwen3-Coder-480B-Instruct"},fallbackModel:{provider:"opencode",model:"big-pickle"},temperature:0.2,steps:6,color:"success"},ce={name:"planner",description:"Architecture design and technical planning specialist",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:deepseek-ai/DeepSeek-V3.2"},fallbackModel:{provider:"opencode",model:"gpt-5-nano"},temperature:0.5,steps:8,color:"primary"},le={name:"documenter",description:"Documentation and comments specialist",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:moonshotai/Kimi-K2.5"},fallbackModel:{provider:"opencode",model:"kimi-k2.5-free"},temperature:0.4,steps:5,color:"info"},de={name:"auditor",description:"Thorough security audit and vulnerability specialist",mode:"subagent",primaryModel:{provider:"synthetic",model:"hf:zai-org/GLM-4.7"},fallbackModel:{provider:"opencode",model:"big-pickle"},temperature:0.1,steps:6,color:"danger"},x=[te,oe,ne,re,se,ie,ae,ce,le,de];var pe=["code-analysis","security-scanning","project-intelligence","workflow-automation","external-integration","development-utilities"],me=["feature-implementation","bug-fix","refactoring","api-endpoint","code-review","security-audit","test-coverage","performance-optimization","add-documentation","update-readme","create-api-docs","dependency-update","code-cleanup","migration-assistance"],ue={name:"full",description:"Full framework with everything - jack of all trades",agents:["orchestrate","coder","reviewer","tester","explorer","researcher","implementer","planner","documenter","auditor"],tools:pe,commands:me},ge={name:"stock",description:"Recommended for most users - balanced feature set",agents:["orchestrate","coder","reviewer","tester","explorer","planner","documenter"],tools:["code-analysis","security-scanning","project-intelligence","workflow-automation"],commands:["feature-implementation","bug-fix","code-review","security-audit","test-coverage","add-documentation","dependency-update"]},fe={name:"micro",description:"Speed-optimized for fast execution",agents:["orchestrate","coder","explorer","researcher"],tools:["code-analysis","project-intelligence","workflow-automation"],commands:["feature-implementation","bug-fix","code-review","test-coverage","add-documentation"]},he={name:"mini",description:"Balanced default for everyday use",agents:["orchestrate","coder","reviewer","tester","explorer"],tools:["code-analysis","security-scanning","project-intelligence"],commands:["feature-implementation","bug-fix","code-review","security-audit","test-coverage","add-documentation","dependency-update"]},ye={name:"nano",description:"Lightweight starter with core functionality",agents:["orchestrate","coder","explorer"],tools:["code-analysis","project-intelligence"],commands:["feature-implementation","bug-fix","code-review","add-documentation"]},Me={name:"pico",description:"Barebones for advanced users who build custom systems",agents:["orchestrate","coder"],tools:[],commands:["feature-implementation","bug-fix"]},f=[ue,ge,fe,he,ye,Me];function P(e){return`{
  "$schema": "https://opencode.ai/config.json",
  "default_agent": "orchestrate",
  "subagents": {
    "*": false
  },
  "agent": {
    ${["build","plan","explore","general"].map((t)=>`"${t}": { "disable": true }`).join(`,
    `)},
    ${e.map((t)=>`"${t}": { "mode": "subagent" }`).join(`,
    `)}
  }
}
`}var h=require("fs"),g=globalThis.Bun;function u(){return process.env.HOME??process.env.USERPROFILE??process.env.HOMEDIR??"/home/user"}async function k(){try{return await g.$`which opencode`.quiet(),!0}catch{return!1}}async function E(){console.log("Installing OpenCode...");try{await g.$`bun install -g opencode`,console.log("OpenCode installed successfully")}catch(e){console.error("Failed to install OpenCode:",e),process.exit(1)}}async function O(){try{return await g.$`which bun`.quiet(),!0}catch{return!1}}async function N(){console.log("Installing Bun...");try{await g.$`curl -fsSL https://bun.sh/install | bash`,console.log("Bun installed successfully. Please restart your shell and run install script again"),process.exit(0)}catch(e){console.error("Failed to install Bun:",e),process.exit(1)}}function $(){if(process.platform==="win32")console.warn("Windows detected. This framework requires macOS/Linux"),console.warn("Please use WSL2 on Windows to install this framework"),process.exit(1)}function I(){if(process.env.SYNTHETIC_API_KEY)return!0;let t=`${u()}/.local/share/opencode/auth.json`;try{let o=h.readFileSync(t,"utf-8").trim();if(o){if(JSON.parse(o).synthetic?.key?.trim())return!0}}catch(o){console.warn("No valid auth.json found for synthetic API key detection:",o)}let r=`${u()}/.secrets/synthetic-api-key`;try{return h.readFileSync(r,"utf-8").trim().length>0}catch{return!1}}function _(){let e=`${u()}/.local/share/opencode/auth.json`;try{let t=h.readFileSync(e,"utf-8").trim();if(!t)return!1;return JSON.parse(t),!0}catch{return!1}}var d=require("fs"),l=require("path"),D=globalThis.Bun;async function y(e){try{await D.$`mkdir -p ${e}`.quiet()}catch(t){console.warn(`Failed to create directory ${e}: ${t.message}`)}}function b(e){try{d.mkdirSync(e,{recursive:!0})}catch(t){console.warn(`Failed to create directory ${e}: ${t.message}`)}}async function R(e){await y(`${e}/agents`),await y(`${e}/plugins`),await y(`${e}/commands`),await y(`${e}/meta`)}function T(e,t,r){let o=l.join(r,"plugins");b(o),e.forEach((s)=>{let n=l.join(t,`plugins/${s}.ts`);try{let i=d.readFileSync(n,"utf-8"),c=l.join(o,`${s}.ts`);d.writeFileSync(c,i),console.log(`Created: ${c}`)}catch(i){console.warn(`Plugin ${s} not found, skipping...`)}})}function L(e,t,r){let o=l.join(r,"commands");b(o),e.forEach((s)=>{let n=l.join(t,`templates/commands/${s}.md`);try{let i=d.readFileSync(n,"utf-8"),c=l.join(o,`${s}.md`);d.writeFileSync(c,i),console.log(`Created: ${c}`)}catch(i){console.warn(`Command ${s} not found, skipping...`)}})}function B(e,t){let r=l.join(e,"meta"),o=l.join(t,"meta");b(o),["agent-template.md","command-template.md","tool-template.ts"].forEach((n)=>{let i=l.join(r,n),c=d.readFileSync(i,"utf-8"),m=l.join(o,n);d.writeFileSync(m,c),console.log(`Created: ${m}`)})}function F(e,t,r,o,s){let n=`${e}/${t}`;if(s.includes(n))return n;let i=`${r}/${o}`;if(s.includes(i))return i;return console.warn(`Neither ${n} nor ${i} available`),i}function j(e,t){if(t)return t;console.log(`
Select preset:`),e.forEach((n,i)=>{console.log(`  ${i+1}) ${n.name.padEnd(10)} - ${n.description}`)});let r=prompt("Enter preset number (1-6):"),o=Number.parseInt(r||"1",10)-1;if(Number.isNaN(o)||o<0||o>=e.length)return console.log("Invalid selection - using 'stock' preset..."),"stock";return e[o]?.name||"stock"}var W=require("fs"),Y=require("path");var be=["npm install","npm run build","npm run dev","npm run serve","npm test","npm run test","npm run lint","npm run typecheck"],Ae=["yarn install","yarn build","yarn test","yarn lint"],Se=["pnpm install","pnpm build","pnpm test"],ve=["bun install","bun run build","bun run dev","bun test","bun run test"],we=["deno install","deno task build","deno task test","deno task fmt","deno lint"],Ce=["python -m build","pip install","pytest","python -m pytest","ruff check","python -m unittest"],xe=["cargo build","cargo test","cargo run","cargo clippy","rustc"],Pe=["go build","go test","go run","golangci-lint"],ke=["mvn compile","mvn package","mvn test","ant build","ant test","gradle build","gradle test","./gradlew build","./gradlew test"],Ee=["dotnet build","dotnet test","dotnet run"],Oe=["cmake --build build"],Ne=["make","make build","make test"],$e=["xmake build","xmake test"],Ie=["swift build","swift test"],_e=["gem install","bundle install","bundle exec rspec"],De=["composer install","phpunit"],H=[...be,...Ae,...Se,...ve,...we,...Ce,...xe,...Pe,...ke,...Ee,...Oe,...Ne,...$e,...Ie,..._e,...De],Re=["npm publish"],Te=["yarn publish"],Le=["pnpm publish"],Be=["cargo publish"],Fe=["git commit","git push","git merge","git rebase","git cherry-pick","git tag","git add"],je=["gh pr merge","gh repo create"],He=["docker push"],Ue=["kubectl","helm","terraform apply","serverless deploy"],Ke=["sed","awk","perl -pi"],U=[...Fe,...je,...Re,...Te,...Le,...Be,...He,...Ue,...Ke];var K="    ";function z(e,t,r){return e.map((o)=>`${t}"${o}": "${r}"`).join(`
`)}function G(e,t,r){let o=Y.join(r,`templates/agents/${e.name}.md`),s=W.readFileSync(o,"utf-8"),n=z(H,K,"allow"),i=z(U,K,"deny");return s.replace(/{{description}}/g,e.description).replace(/{{mode}}/g,e.mode).replace(/{{model}}/g,t).replace(/{{temperature}}/g,e.temperature.toString()).replace(/{{steps}}/g,e.steps.toString()).replace(/{{color}}/g,e.color??"success").replace(/^[ \t]*{{bash_denylist}}[ \t]*$/gm,i).replace(/^[ \t]*{{bash_allowlist}}[ \t]*$/gm,n)}async function J(){try{return(await(await fetch("https://api.github.com/repos/xsyetopz/octoagents/releases/latest")).json()).tag_name??void 0}catch(r){console.warn("Failed to check for updates:",r.message);return}}var A=globalThis.Bun;async function q(e){let t=new Date().toISOString().replace(/[:.]/g,"-"),r=`${e}.backup-${t}`;try{await A.$`test -d ${e}`.quiet(),await A.$`mv ${e} ${r}`,console.log(`Backed up existing install to ${r}`)}catch{console.log("No existing install directory found, skipping backup...")}}function S(e,t){return`${e}/${t}`}var Q=globalThis.Bun;async function V(){try{let{stdout:e}=await Q.$`opencode models`,t=[],r=e.toString().split(`
`);for(let o of r){let s=o.trim();if(!s||s.startsWith("krystian@"))continue;let n=s.split("/");if(n.length>=2&&n[0])t.push({provider:n[0],model:n.slice(1).join("/")})}return t}catch(e){return console.warn("Failed to get available models:",e),[]}}var M=p.join(process.cwd()),ze=process.argv.includes("--update"),We=process.argv.find((e)=>f.some((t)=>t.name===e));function Ye(e){console.log(`
Select install location:`),console.log("  1) Global (~/.config/opencode)"),console.log("  2) Project (./.opencode)"),console.log("  3) Custom path");let t=prompt("Enter location number (1-3):"),r=Number.parseInt(t||"1",10)-1;if(Number.isNaN(r)||r<0||r>2)return console.log("Invalid selection - using global install location..."),e;switch(r){case 0:return e;case 1:return p.join(process.cwd(),".opencode");case 2:break;default:return e}let o=prompt("Enter custom install path:")?.trim();if(!o)return console.log("Invalid custom path - using global install location..."),e;return p.isAbsolute(o)?o:p.join(process.cwd(),o)}async function Ge(){if(console.log(`OctoAgents Framework Installer
`),$(),!await O())await N();if(!await k())await E();if(ze){console.log("Checking for updates...");let a=await J();if(a)console.log(`Latest version: ${a}`),console.log("Current version: 1.0.0")}let e=I(),t=_();console.log(e?`
\u2713 Synthetic API key detected`:`
\u2717 No Synthetic API key - using OpenCode Zen models...`),console.log(t?"\u2713 OpenCode auth.json detected":"\u2717 No OpenCode auth.json detected");let o=(await V()).map((a)=>`${a.provider}/${a.model}`);if(o.length>0)console.log(`Found ${o.length} available models`);else console.log("No models detected, will use default assignments");let s=j(f,We),n=f.find((a)=>a.name===s);if(!n)console.error("Invalid preset selection"),process.exit(1);console.log(`
Installing '${s}' preset...`);let i=p.join(u(),".config/opencode"),c=Ye(i);console.log(`
Install location: ${c}`),await q(c),await R(c);let m=x.filter((a)=>n.agents.includes(a.name));for(let a of m){let Z=F(a.primaryModel.provider,a.primaryModel.model,a.fallbackModel.provider,a.fallbackModel.model,o),ee=G(a,Z,M),C=S(c,`agents/${a.name}.md`);v.writeFileSync(C,ee),console.log(`Created: ${C}`)}if(n.tools.length>0)T(n.tools,M,c);if(n.commands.length>0)L(n.commands,M,c);B(M,c);let X=P(n.agents),w=S(c,"opencode.jsonc");v.writeFileSync(w,X),console.log(`Created: ${w}`),console.log(`
\u2713 Installation complete!`),console.log(`
Preset: ${s}`),console.log(`Agents: ${m.map((a)=>a.name).join(", ")}`),console.log(`Tools: ${n.tools.length}`),console.log(`Commands: ${n.commands.length}`),console.log(`
Next steps:`),console.log("  1. Restart OpenCode to load the new agents"),console.log("  2. Use 'opencode agents list' to verify installation"),console.log("  3. Select 'orchestrate' agent to use the framework"),console.log(`
To update the framework, run: bun install --update`),console.log("To change preset, run: bun install [preset-name]")}Ge().catch((e)=>{console.error("Installation failed:",e),process.exit(1)});})
